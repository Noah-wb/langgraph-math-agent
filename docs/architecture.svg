<?xml version="1.0" encoding="UTF-8"?>
<svg width="1200" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 24px; font-weight: bold; fill: #2c3e50; }
      .layer-title { font-family: Arial, sans-serif; font-size: 16px; font-weight: bold; fill: #34495e; }
      .component-title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; fill: #2c3e50; }
      .component-text { font-family: Arial, sans-serif; font-size: 12px; fill: #34495e; }
      .arrow { stroke: #3498db; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .data-flow { stroke: #e74c3c; stroke-width: 2; fill: none; stroke-dasharray: 5,5; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3498db" />
    </marker>
  </defs>
  
  <!-- 标题 -->
  <text x="600" y="30" text-anchor="middle" class="title">LangGraph 数据分析智能体系统架构</text>
  
  <!-- CLI 层 -->
  <rect x="50" y="60" width="1100" height="80" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="2" rx="10"/>
  <text x="70" y="85" class="layer-title">CLI 层 (main.py)</text>
  <rect x="70" y="95" width="1060" height="35" fill="#ffffff" stroke="#bdc3c7" rx="5"/>
  <text x="80" y="115" class="component-title">MathAgentCLI</text>
  <text x="80" y="130" class="component-text">• 用户交互界面 • 模型选择 • 命令处理 • 流式对话</text>
  
  <!-- 核心层 -->
  <rect x="50" y="160" width="1100" height="120" fill="#e8f4fd" stroke="#3498db" stroke-width="2" rx="10"/>
  <text x="70" y="185" class="layer-title">核心层 (src/)</text>
  
  <!-- Agent 层 -->
  <rect x="70" y="200" width="300" height="70" fill="#ffffff" stroke="#3498db" rx="5"/>
  <text x="80" y="220" class="component-title">Agent 层 (agent.py)</text>
  <text x="80" y="235" class="component-text">• LangGraph 状态图</text>
  <text x="80" y="250" class="component-text">• 工具调用 • 流式处理</text>
  <text x="80" y="265" class="component-text">• 日志记录</text>
  
  <!-- 模型管理层 -->
  <rect x="390" y="200" width="300" height="70" fill="#ffffff" stroke="#3498db" rx="5"/>
  <text x="400" y="220" class="component-title">模型管理层 (models.py)</text>
  <text x="400" y="235" class="component-text">• 多模型支持</text>
  <text x="400" y="250" class="component-text">• 模型切换 • 配置管理</text>
  <text x="400" y="265" class="component-text">• API Key 管理</text>
  
  <!-- 历史管理层 -->
  <rect x="710" y="200" width="300" height="70" fill="#ffffff" stroke="#3498db" rx="5"/>
  <text x="720" y="220" class="component-title">历史管理层 (chat_history.py)</text>
  <text x="720" y="235" class="component-text">• 会话管理</text>
  <text x="720" y="250" class="component-text">• 历史存储 • 会话恢复</text>
  <text x="720" y="265" class="component-text">• 消息管理</text>
  
  <!-- 工具层 -->
  <rect x="50" y="300" width="1100" height="120" fill="#f0f8e8" stroke="#27ae60" stroke-width="2" rx="10"/>
  <text x="70" y="325" class="layer-title">工具层 (src/data_tools.py)</text>
  
  <rect x="70" y="340" width="1060" height="70" fill="#ffffff" stroke="#27ae60" rx="5"/>
  <text x="80" y="360" class="component-title">数据分析工具集</text>
  <text x="80" y="375" class="component-text">• CSV文件操作 (list_csv_files, load_csv_file)</text>
  <text x="80" y="390" class="component-text">• 统计分析 (get_column_stats, calculate_summary)</text>
  <text x="80" y="405" class="component-text">• 数据筛选 (filter_data, search_rows) • 聚合分析 (group_by_sum, group_by_aggregate)</text>
  
  <!-- 支持层 -->
  <rect x="50" y="440" width="1100" height="120" fill="#fdf2e9" stroke="#e67e22" stroke-width="2" rx="10"/>
  <text x="70" y="465" class="layer-title">支持层</text>
  
  <!-- 日志系统 -->
  <rect x="70" y="480" width="300" height="70" fill="#ffffff" stroke="#e67e22" rx="5"/>
  <text x="80" y="500" class="component-title">日志系统 (logger.py)</text>
  <text x="80" y="515" class="component-text">• 性能监控</text>
  <text x="80" y="530" class="component-text">• 调用记录 • 错误追踪</text>
  <text x="80" y="545" class="component-text">• 模型调用日志</text>
  
  <!-- 配置管理 -->
  <rect x="390" y="480" width="300" height="70" fill="#ffffff" stroke="#e67e22" rx="5"/>
  <text x="400" y="500" class="component-title">配置管理 (config.yaml)</text>
  <text x="400" y="515" class="component-text">• 模型配置</text>
  <text x="400" y="530" class="component-text">• API配置 • 应用配置</text>
  <text x="400" y="545" class="component-text">• 数据分析配置</text>
  
  <!-- 数据存储 -->
  <rect x="710" y="480" width="300" height="70" fill="#ffffff" stroke="#e67e22" rx="5"/>
  <text x="720" y="500" class="component-title">数据存储 (data/)</text>
  <text x="720" y="515" class="component-text">• CSV数据文件</text>
  <text x="720" y="530" class="component-text">• 会话历史 • 日志文件</text>
  <text x="720" y="545" class="component-text">• 报告输出</text>
  
  <!-- 数据流箭头 -->
  <line x1="220" y1="140" x2="220" y2="160" class="arrow"/>
  <line x1="220" y1="280" x2="220" y2="300" class="arrow"/>
  <line x1="220" y1="420" x2="220" y2="440" class="arrow"/>
  
  <!-- 组件间连接 -->
  <line x1="370" y1="235" x2="390" y2="235" class="arrow"/>
  <line x1="690" y1="235" x2="710" y2="235" class="arrow"/>
  
  <!-- 数据流标签 -->
  <text x="230" y="155" class="component-text" fill="#3498db">用户输入</text>
  <text x="230" y="295" class="component-text" fill="#3498db">工具调用</text>
  <text x="230" y="435" class="component-text" fill="#3498db">日志记录</text>
  
  <!-- 数据流图 -->
  <rect x="50" y="580" width="1100" height="200" fill="#f8f9fa" stroke="#6c757d" stroke-width="1" rx="10"/>
  <text x="70" y="605" class="layer-title">数据流图</text>
  
  <!-- 流程节点 -->
  <circle cx="150" cy="650" r="30" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
  <text x="150" y="655" text-anchor="middle" class="component-text" fill="white">用户输入</text>
  
  <circle cx="300" cy="650" r="30" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
  <text x="300" y="655" text-anchor="middle" class="component-text" fill="white">CLI界面</text>
  
  <circle cx="450" cy="650" r="30" fill="#f39c12" stroke="#e67e22" stroke-width="2"/>
  <text x="450" y="655" text-anchor="middle" class="component-text" fill="white">Agent处理</text>
  
  <circle cx="600" cy="650" r="30" fill="#9b59b6" stroke="#8e44ad" stroke-width="2"/>
  <text x="600" y="655" text-anchor="middle" class="component-text" fill="white">模型推理</text>
  
  <circle cx="750" cy="650" r="30" fill="#27ae60" stroke="#229954" stroke-width="2"/>
  <text x="750" y="655" text-anchor="middle" class="component-text" fill="white">工具调用</text>
  
  <circle cx="900" cy="650" r="30" fill="#1abc9c" stroke="#16a085" stroke-width="2"/>
  <text x="900" y="655" text-anchor="middle" class="component-text" fill="white">数据分析</text>
  
  <circle cx="1050" cy="650" r="30" fill="#34495e" stroke="#2c3e50" stroke-width="2"/>
  <text x="1050" y="655" text-anchor="middle" class="component-text" fill="white">结果返回</text>
  
  <!-- 流程箭头 -->
  <line x1="180" y1="650" x2="270" y2="650" class="data-flow"/>
  <line x1="330" y1="650" x2="420" y2="650" class="data-flow"/>
  <line x1="480" y1="650" x2="570" y2="650" class="data-flow"/>
  <line x1="630" y1="650" x2="720" y2="650" class="data-flow"/>
  <line x1="780" y1="650" x2="870" y2="650" class="data-flow"/>
  <line x1="930" y1="650" x2="1020" y2="650" class="data-flow"/>
  
  <!-- 流程标签 -->
  <text x="225" y="640" class="component-text" fill="#e74c3c">命令解析</text>
  <text x="375" y="640" class="component-text" fill="#e74c3c">会话管理</text>
  <text x="525" y="640" class="component-text" fill="#e74c3c">状态图</text>
  <text x="675" y="640" class="component-text" fill="#e74c3c">LLM调用</text>
  <text x="825" y="640" class="component-text" fill="#e74c3c">工具执行</text>
  <text x="975" y="640" class="component-text" fill="#e74c3c">数据处理</text>
  
  <!-- 下方流程标签 -->
  <text x="225" y="700" class="component-text" fill="#e74c3c">历史记录</text>
  <text x="375" y="700" class="component-text" fill="#e74c3c">状态管理</text>
  <text x="525" y="700" class="component-text" fill="#e74c3c">条件判断</text>
  <text x="675" y="700" class="component-text" fill="#e74c3c">工具选择</text>
  <text x="825" y="700" class="component-text" fill="#e74c3c">结果记录</text>
  <text x="975" y="700" class="component-text" fill="#e74c3c">报告生成</text>
  <text x="1125" y="700" class="component-text" fill="#e74c3c">用户界面</text>
  
  <!-- 流式输出箭头 -->
  <line x1="1080" y1="650" x2="1080" y2="680" class="arrow"/>
  <text x="1090" y="675" class="component-text" fill="#3498db">流式输出</text>
</svg>
